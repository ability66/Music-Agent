# Bilibili 登录维护工具

## 功能说明

`login_bilibili.py` 是一个独立的 Bilibili 登录状态检查和维护程序，用于：

1. **检查登录状态**：自动检测当前是否已登录 Bilibili
2. **维护登录会话**：定期运行可以保持登录状态不过期
3. **避免中断主流程**：在运行主程序前先确保登录状态正常

## 使用方法

### 基本使用

```bash
python login_bilibili.py
```

### 使用场景

#### 场景 1：首次使用
第一次运行时，程序会：
- 打开浏览器访问 Bilibili
- 提示你手动登录
- 登录完成后保存登录状态

#### 场景 2：定期维护
建议定期运行此程序（如每周一次），以保持登录状态：
- 如果已登录，程序会显示 "✅ 已检测到登录状态" 并直接退出
- 如果登录过期，程序会提示重新登录

#### 场景 3：运行主程序前检查
在运行 `agent.py` 之前，先运行 `login_bilibili.py` 确保登录正常：

```bash
# 1. 先检查/维护登录状态
python login_bilibili.py

# 2. 确认登录后再运行主程序
python agent.py
```

这样可以避免主程序运行到一半时因登录过期而中断。

## 工作原理

1. **持久化会话**：使用 `playwright_bili_profile/` 目录保存浏览器会话
2. **共享登录状态**：与 `publisher/bilibili_playwright.py` 共用同一个配置目录
3. **自动检测**：通过检查页面上是否有"登录"按钮来判断登录状态

## 注意事项

- 登录状态保存在 `playwright_bili_profile/` 目录中
- 程序会打开浏览器窗口（非无头模式），这是正常的
- 首次登录需要手动完成扫码或密码登录
- 登录状态可能会因为以下原因过期：
  - 长时间未使用（通常是几周到一个月）
  - B站安全策略变化
  - 清除了 `playwright_bili_profile/` 目录

## 常见问题

**Q: 为什么需要这个单独的登录程序？**
A: 避免主程序运行到一半时登录过期导致流程中断。可以提前检查和维护登录状态。

**Q: 多久需要运行一次？**
A: 建议每周运行一次，或者在运行主程序前运行一次。

**Q: 登录状态保存在哪里？**
A: 保存在项目根目录的 `playwright_bili_profile/` 文件夹中。

**Q: 可以删除 `playwright_bili_profile/` 目录吗？**
A: 可以，但删除后需要重新登录。

## 技术细节

- **使用技术**：Playwright (chromium)
- **配置目录**：`playwright_bili_profile/`
- **检测方式**：通过 `text=登录` 定位器检查登录按钮是否存在
- **浏览器模式**：非无头模式（headless=False）
